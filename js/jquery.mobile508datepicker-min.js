/*
	Author: @jsdev | Anthony Delorie June 2013
	Github: https://github.com/jsdev/mobile508datepicker
	MIT License: as is, feel free to fork =)
	Tested on: IOS, Android, Surface, Modern Browsers, IE10+, IE9
 */(function(e){"use strict";e.fn.extend({mobile508datepicker:function(t){var n=new Date,r={MIN:new Date((new Date).setFullYear(n.getFullYear()-10)),MAX:new Date((new Date).setFullYear(n.getFullYear()+10))},i=null,s=e('<section class="datetime-picker" id="date-picker" data-role="popup" data-dismissible="false" data-overlay-theme="a"> 					<a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right cancel">Close</a> 					<h1 class="ui-title" role="heading" aria-level="1" class="date">Today</h1> 					<div class="columns"><b class="month"><ul></ul></b><b class="day"><ul></ul></b><b class="year"><ul></ul></b></div> 					<button id="set-btn" data-theme="b" class="ui-btn-hidden" data-disabled="false">SET</button> 					</section>'),o=function(){e("body").append(s);s.trigger("create");s.popup();return s},u=null,a=function(e){var t=typeof e=="number"?new Date(e):e;return{year:t.getFullYear(),month:t.getMonth(),day:t.getDate()}},f=function(e,t,n,r,i){var o=s.find("."+i+":disabled");o.prop("disabled",!1);if(e===c.year){t===c.month?n.prop("disabled",!0).addClass(i):o.prop("disabled",!1);r.prop("disabled",!0).addClass(i)}},l=a(n),c=null,h=null,p=null,d=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],v=["Su ","Mo ","Tu ","We ","Th ","Fr ","Sa "],m=function(){var e,t,n=[];for(e=1;e<10;e++)n.push('<li><button data-value="'+e+'">0'+e+"</button></li>");for(e=10;e<=31;e++)n.push('<li><button data-value="'+e+'">'+e+"</button></li>");P.html(n.join(""));j=P.children();for(e=p.year,n=[],t=h.year;e<=t;e++)n.push('<li><button data-value="'+e+'">'+e+"</button></li>");_.html(n.join(""));for(e=0,n=[],t=d.length;e<t;e++)n.push('<li><button data-value="'+e+'">'+d[e]+"</button></li>");D.html(n.join(""))},g=function(){var e=h.day,t=h.month,n=h.year,r=D.find("button").slice(t+1,12),i=P.find("button").slice(e,31);f(n,t,i,r,"too-soon")},y=function(){var e=p.day,t=p.month,n=p.year,r=D.find("button").slice(0,t),i=P.find("button").slice(0,e-1);f(n,t,i,r,"too-late")},b=function(){e(".too-soon").prop("disabled",!1).removeClass("too-soon");e(".too-late").prop("disabled",!1).removeClass("too-late")},w=function(){return(new Date(c.year,1+c.month,0)).getDate()},E=function(t){N();t&&t!=="day"&&x();e(".selected").removeAttr("class");_.find('[data-value="'+c.year+'"]').add(P.find('[data-value="'+c.day+'"]')).add(D.find('[data-value="'+c.month+'"]')).addClass("selected").scrollTopMe();S();t&&t!=="day"&&b(),y(),g()},S=function(){var e=N();F.innerHTML=e.toDateString()===n.toDateString()?"Today":v[e.getDay()]},x=function(){var e=w(),t=j.length,n,r;j.show();for(n=0;n<t;n++)r=new Date([c.month,n+1,c.year].join("/"));for(n=e;n<t;n++)j.eq(n).hide();c.day>e&&(c.day=e)},T=function(t){var n=t.focus().parent(),r=n.parent(),i=e(":focus"),s;if(!t.length||t.prop("disabled")){i.focus();return!1}s=r.parent()[0].className;c[s]=t.data("value");E(s);return!0},N=function(){var t=new Date(c.year,c.month,c.day),n=i.MAX,r=i.MIN;if(n&&t>n){e.extend(c,h);return new Date(c.year,c.month,c.day)}if(r&&t<r){e.extend(c,p);return new Date(c.year,c.month,c.day)}return t},C=function(e){var t=e.children(),n=t.eq(0).height(),r=e.position().top,i=Math.round(-r/n),s=e.find("button"),o=t.eq(i).find("button"),u=e.find(".selected"),a=s.index(u),f=e.parent()[0].className;if(!o.prop("disabled")){if(a===i)return;e.scrollTop(-i*n+n);c[f]=o.data().value;E(f);return}o=e.find("button:enabled").eq(a>i?0:-1);i=s.index(o);e.scrollTop(-i*n+n);c[f]=o.data().value;E(f);return},k=function(){var e=s.find("ul"),t,n,r,i,o,u,a,f=[1,0,2];while(f.length){t=e.eq(f.pop());o=t.find("button");n=t.children();r=n.eq(0).height();u=t.position().top;a=Math.round(-u/r);i=n.eq(a).find("button");a=o.index(i);t.scrollTop(-a*r);c[t.parent()[0].className]=i.data().value;E()}},L=function(){c=null;h=null;p=null},A=function(){if(i.MIN>i.MAX){var e=i.MIN;i.MIN=i.MAX;i.MAX=e}},O=function(){L();s.popup("close");i.onClose&&i.onClose();u.focus()},M=function(){var t=u.val();c=t.length?a(new Date(t)):e.extend({},l);A();i.MIN=i.afterToday?new Date:i.MIN;i.MAX=i.beforeToday?new Date:i.MAX;p=a(i.MIN);h=a(i.MAX);m();E();s.find(".selected").eq(0).focus();s.popup()},_=s.find(".year ul"),D=s.find(".month ul"),P=s.find(".day ul"),H=s.find(".cancel"),B=s.find("#set-btn"),j=null,F=s.find("h1")[0];e.extend(r,t);s.find(".month").on("scrollstop",function(t){C(e(t.currentTarget).find("ul"))});s.find(".day").on("scrollstop",function(t){C(e(t.currentTarget).find("ul"))});s.find(".year").on("scrollstop",function(t){C(e(t.currentTarget).find("ul"))});s.on("click","#set-btn",function(){var e=c.month+1,t=c.day,n=c.year;if(i["leading-zero"]){e=("0"+e).substr(-2);t=("0"+t).substr(-2)}k();u.val([e,t,n].join("/"));O()}).on("keydown","#set-btn",function(t){t.preventDefault();switch(t.which){case 9:t.shiftKey?e(".selected").eq(2).focus():H.focus();break;case 13:t.currentTarget.click()}}).on("click","b button",function(t){T(e(t.currentTarget))}).on("keydown","b",function(t){var n=e(t.currentTarget),r=function(e){var t=n[e]("b").find(".selected").length;if(t){n[e]("b").find(".selected").focus();return}switch(e){case"prev":H.focus();break;case"next":B.focus()}},i=function(e){var t=n.find(".selected").parents("li")[e]("li").find("button");t.length&&!t.prop("disabled")&&T(t)};t.preventDefault();switch(t.which){case 9:t.shiftKey?r("prev"):r("next");break;case 37:r("prev");break;case 38:i("prev");break;case 39:r("next");break;case 40:i("next")}}).on("keydown",".cancel",function(t){t.preventDefault();switch(t.which){case 9:t.shiftKey?B.focus():e(".month .selected").focus();break;case 13:t.currentTarget.click()}}).on("click",".cancel",function(e){e.preventDefault();O()}).on("keydown",function(e){e.which===27&&O()});return this.each(function(){var t=e(this),n=e("#date-picker");n.length||o();t.on("click",function(t){e(".ui-popup-active .ui-popup").popup("close");u=e(t.currentTarget);i=e.extend({},r);e.extend(i,u.data("options"));M();s.popup("open")}).on("keydown",function(e){var t=[13,48,49,50,51,52,53,54,55,56,57];t.indexOf(e.which)+1&&e.currentTarget.click()})})},scrollTopMe:function(){return this.each(function(){var t=e(this).parent(),n=t.parent(),r=n.parent(),i=n.children().index(t)*t.height();r.scrollTop(i)})}})})(jQuery);